1
00:00:00,300 --> 00:00:02,850
Hello and welcome back.

2
00:00:03,270 --> 00:00:09,820
So now we are all set with our resilience for the circuit breaker, and in this lecture we will test

3
00:00:09,820 --> 00:00:11,470
it out, this complete thing.

4
00:00:12,030 --> 00:00:13,610
So let's jump to Estess.

5
00:00:14,370 --> 00:00:18,440
So here we will test out one scenario where address service is down.

6
00:00:18,900 --> 00:00:22,920
So this will give us four four because I trust services down.

7
00:00:23,370 --> 00:00:25,710
So let's start with the Eureka server first.

8
00:00:26,370 --> 00:00:31,430
Then we will start our API gateway and we will start the student service.

9
00:00:31,980 --> 00:00:34,470
So here we will not start the address service.

10
00:00:34,980 --> 00:00:41,250
We want to test the scenario where the address service is down and this client line is giving us an

11
00:00:41,280 --> 00:00:43,440
exception or error is for for.

12
00:00:44,410 --> 00:00:46,960
So this is the streaming service.

13
00:00:46,990 --> 00:00:50,500
Now let's turn to Browsr, let's say the Utica.

14
00:00:52,490 --> 00:00:55,140
So now we are good to mainstream service.

15
00:00:55,540 --> 00:01:01,700
We don't have a train service, so give a minute to epigastric so imposing a lecturer here and after

16
00:01:01,700 --> 00:01:06,150
one minute I will resume it because we are giving some time to a gateway.

17
00:01:07,560 --> 00:01:13,410
So here is the other lobstering service to get the student body and internally it calls the address

18
00:01:13,410 --> 00:01:20,490
service and this is the actuator held wall where we can take the current state forward switch.

19
00:01:20,970 --> 00:01:21,900
So let's say this.

20
00:01:21,900 --> 00:01:22,590
You are on first.

21
00:01:24,650 --> 00:01:29,250
So see the current state of the switches up, that means so it is closer.

22
00:01:29,630 --> 00:01:33,560
So all the calls from student to address are allowed.

23
00:01:34,160 --> 00:01:38,560
So now let me jump to Astiz and let's clear all the logs.

24
00:01:39,080 --> 00:01:40,520
Let's say this, Gadsby.

25
00:01:41,990 --> 00:01:49,160
Now, let's jump to his ideas and let's take the logs, see county equal to one and uptodate what it

26
00:01:49,160 --> 00:01:55,280
give it give for four exception and that's why it is logging into our fall-back matter.

27
00:01:55,730 --> 00:01:58,250
So this is the longest statement county called one.

28
00:01:58,490 --> 00:02:00,080
After that we got four or four.

29
00:02:00,260 --> 00:02:02,230
So it came to our fall-back matter.

30
00:02:02,260 --> 00:02:08,840
It's logging the exception that are equal to the client exception that is for Ford and it's returning

31
00:02:08,840 --> 00:02:12,980
the dummy address response C address service is down.

32
00:02:13,220 --> 00:02:14,570
It's giving the exception.

33
00:02:14,810 --> 00:02:17,720
But still our student service is not really.

34
00:02:18,020 --> 00:02:24,980
You see, we are getting the dummy response or here podiatrists address it equal to zero students are

35
00:02:25,070 --> 00:02:25,490
not.

36
00:02:26,090 --> 00:02:26,540
Why?

37
00:02:26,870 --> 00:02:33,410
Because when this is failing, it is going to our fallback matter and it's returning the dummy response

38
00:02:33,740 --> 00:02:37,160
because our address service is not giving the response.

39
00:02:37,590 --> 00:02:40,030
And here we are getting the county court to one.

40
00:02:40,490 --> 00:02:43,250
Now we are considering last 10 calls.

41
00:02:43,250 --> 00:02:43,580
Right.

42
00:02:43,790 --> 00:02:48,020
And still our suite is closer to let's see the switches up.

43
00:02:48,020 --> 00:02:49,630
That means so it is closer.

44
00:02:50,120 --> 00:02:55,090
So this is second, third, four, five, six, seven, eight.

45
00:02:55,430 --> 00:02:57,020
And let's take the logs.

46
00:02:57,380 --> 00:02:59,080
Total eight now nine.

47
00:02:59,570 --> 00:03:02,190
OK, all nine calls got Philidor.

48
00:03:02,420 --> 00:03:07,470
And still, if you check then the switches up, that means which is closer.

49
00:03:08,120 --> 00:03:09,920
Now let's make the tenth call.

50
00:03:09,920 --> 00:03:14,420
OK, so once we hit that end call it will evaluate the failure rate.

51
00:03:14,540 --> 00:03:21,110
And if it is greater than our threshold, for example, 50 percent, then it will make the switch as

52
00:03:21,260 --> 00:03:25,580
open as per this diagram right from the closer to open.

53
00:03:26,520 --> 00:03:34,310
So let's make the call now, we got the same exception now let's take the state of the switch.

54
00:03:34,410 --> 00:03:38,880
See, the current status is now down, that means which is open.

55
00:03:39,270 --> 00:03:41,880
So it will remain open for 30 seconds.

56
00:03:42,100 --> 00:03:44,720
That's what we said in the properties, OK.

57
00:03:45,210 --> 00:03:49,590
And if we try to hit the address service, let's see what we are getting.

58
00:03:50,540 --> 00:03:57,500
Let me maximize this to show you, it is saying that Paul not permitted see, we are not getting the

59
00:03:57,500 --> 00:03:58,390
council statement.

60
00:03:58,400 --> 00:03:58,880
Why?

61
00:03:59,270 --> 00:04:02,480
Because as of now, the switch is open.

62
00:04:02,870 --> 00:04:07,160
So using this annotation, resilience, they will not execute this method.

63
00:04:07,460 --> 00:04:13,310
And instead of that, it will directly call this fallback method and it will return the dummy response,

64
00:04:13,310 --> 00:04:14,270
whatever we said.

65
00:04:14,720 --> 00:04:20,750
And that's why we are not getting the count logo here, because the switch is open.

66
00:04:21,080 --> 00:04:21,890
Let's take again.

67
00:04:22,430 --> 00:04:24,290
Yes, 30 seconds, Capossela.

68
00:04:24,800 --> 00:04:27,170
So now the sweet state is unknown.

69
00:04:27,320 --> 00:04:28,910
That means half open.

70
00:04:30,620 --> 00:04:35,870
Now, in half of one state, how many calls we are allowing, five calls we are allowing, right.

71
00:04:36,200 --> 00:04:40,370
So let me clear the logs and let's hit this.

72
00:04:40,880 --> 00:04:42,860
One, two, three, four.

73
00:04:43,870 --> 00:04:52,570
So if we take the logs, 11, 12, 13, 14, C, now this matter is getting executed and that's why

74
00:04:52,570 --> 00:04:59,530
it's making the count plus plus now the still the current state of the sweetshop half open, that means

75
00:04:59,530 --> 00:04:59,980
unknown.

76
00:05:00,490 --> 00:05:03,400
Let's make the call in half open state.

77
00:05:03,790 --> 00:05:06,040
So total 15 calls.

78
00:05:06,040 --> 00:05:07,750
We made it so far.

79
00:05:07,790 --> 00:05:11,580
OK, whatever got over here and total 16 one in the open state.

80
00:05:12,040 --> 00:05:13,390
Now let's take the current state.

81
00:05:13,570 --> 00:05:14,570
Now it go down.

82
00:05:14,930 --> 00:05:15,330
Why?

83
00:05:15,550 --> 00:05:18,010
Because all five calls got filled.

84
00:05:18,190 --> 00:05:22,660
So our failure rate is 100 percent, which is greater than our threshold.

85
00:05:22,660 --> 00:05:23,610
That is 50 percent.

86
00:05:23,920 --> 00:05:29,590
So from half open it will go to open state and that's why it's down.

87
00:05:29,610 --> 00:05:36,970
See, so for 30 seconds it will be in the open state and after that it will be automatically going to

88
00:05:36,970 --> 00:05:37,710
happen.

89
00:05:38,440 --> 00:05:40,320
So let's wait for 30 seconds.

90
00:05:40,340 --> 00:05:45,310
See now the current state of the sweetie's unknown, that means half open.

91
00:05:47,140 --> 00:05:52,980
So here in half one state, again, we will make the five calls, but there is a slight difference.

92
00:05:53,590 --> 00:05:57,670
So let me clear the logs in tears first and.

93
00:05:58,750 --> 00:06:05,810
Let's sit this one second time, so two times it got filled, OK, because our address services.

94
00:06:05,910 --> 00:06:06,850
Now that's fine.

95
00:06:07,250 --> 00:06:09,860
Now let's bring back the address service.

96
00:06:10,020 --> 00:06:16,210
OK, so let's start the service, give it some time to register with the customer and get it.

97
00:06:19,300 --> 00:06:21,730
It got started, but still we are giving some time.

98
00:06:22,990 --> 00:06:26,910
So now what we are going to do is that we need to go so far, right?

99
00:06:27,340 --> 00:06:30,580
So another three calls we will make in the half open state.

100
00:06:31,120 --> 00:06:35,140
So total five calls in one state, which we are permitting.

101
00:06:35,360 --> 00:06:35,740
Right.

102
00:06:36,130 --> 00:06:40,560
But now for three calls, we will get the response from address service.

103
00:06:40,570 --> 00:06:40,970
Why?

104
00:06:41,230 --> 00:06:48,340
Because just now we started the address service, so out of five to got Philidor and three success.

105
00:06:48,820 --> 00:06:53,620
So the failure rate is 40 percentage, which is less than Twelver threshold.

106
00:06:53,770 --> 00:06:58,040
If you see in this diagram, 40 percent is less than two percent.

107
00:06:58,420 --> 00:07:02,630
So the switch will change its state from the half open to closer.

108
00:07:02,800 --> 00:07:08,710
So that's what we are going to test it out because we are already seen from closer to open, open to

109
00:07:08,710 --> 00:07:11,070
happen and happen to open.

110
00:07:11,440 --> 00:07:14,970
Now we are going to check from half open to closer.

111
00:07:15,760 --> 00:07:23,500
So let's go to Browsr and let's take a Paquita is working with a trade service or.

112
00:07:25,980 --> 00:07:27,180
Yes, now it's good.

113
00:07:28,510 --> 00:07:35,890
So this is one see, we are getting proper response for address, which is why because now address service

114
00:07:35,890 --> 00:07:36,420
is up.

115
00:07:36,760 --> 00:07:38,500
So let's go to student service.

116
00:07:39,520 --> 00:07:40,940
So this is the third call.

117
00:07:40,970 --> 00:07:42,950
OK, now we are getting done properly.

118
00:07:43,480 --> 00:07:44,990
We don't see any exception.

119
00:07:45,010 --> 00:07:50,340
It's not going into the fallback matter because we are getting the proper response from the address

120
00:07:50,410 --> 00:07:50,880
service.

121
00:07:51,190 --> 00:07:53,370
So it is returning this response only.

122
00:07:53,380 --> 00:07:58,010
And that's why we are getting the proper address details for this particular student.

123
00:07:58,540 --> 00:08:02,170
So this is the first call that is called successful.

124
00:08:03,010 --> 00:08:04,740
Now, this is total fourth call.

125
00:08:04,750 --> 00:08:07,320
So to got to got success.

126
00:08:08,050 --> 00:08:09,610
Now this is last call.

127
00:08:10,240 --> 00:08:11,800
So what triggered success?

128
00:08:12,550 --> 00:08:14,440
Let's take the current state of the switch.

129
00:08:14,890 --> 00:08:16,880
See, it got changed to up.

130
00:08:17,200 --> 00:08:22,890
That means switches is closer, so 40 percent is less than 50 percent.

131
00:08:23,260 --> 00:08:27,460
So that switch is changing its state from half open to closer.

132
00:08:27,880 --> 00:08:29,530
And that's what we can see or hear.

133
00:08:29,950 --> 00:08:36,730
Now, all calls are allowed from student to address service because of a circuit breaker incensing that

134
00:08:36,970 --> 00:08:37,420
address.

135
00:08:37,450 --> 00:08:40,880
Service has recovered from the issue, whatever it was having.

136
00:08:41,290 --> 00:08:47,140
So it is making the switch as Clouzot That means up or hearing the actuator.

137
00:08:48,490 --> 00:08:55,660
So here we tested all the scenarios as per this diagram from closed to open, open to happen and again,

138
00:08:55,930 --> 00:08:58,780
open to open and from open to close.

139
00:08:58,780 --> 00:09:02,650
Look, when the failure rate is less than threshold, whatever we set.

140
00:09:03,400 --> 00:09:06,940
So this is all about resilience, where the circuit breaker.

141
00:09:07,330 --> 00:09:12,430
Now, let's see when you should not use a circuit breaker for your micro services.

142
00:09:12,790 --> 00:09:14,770
So let's take one scenario.

143
00:09:15,280 --> 00:09:21,190
So, for example, our student service is calling the payment service, OK, while registering the student.

144
00:09:21,460 --> 00:09:26,560
We are calling the payment service for the fees, whatever it is OK for semester or examination fee.

145
00:09:26,860 --> 00:09:29,190
Now, this is related to money.

146
00:09:29,680 --> 00:09:34,930
So if your payment service is failing, then you should not return the dummy response for the payment.

147
00:09:35,440 --> 00:09:38,140
OK, so you should fill the student service.

148
00:09:38,530 --> 00:09:44,380
So whenever you are wanting to have some critical data, you should not go with the circuit breaker

149
00:09:44,560 --> 00:09:49,930
and you should not return the dummy response because it's not good for your application.

150
00:09:50,170 --> 00:09:56,170
Now, if you return the dummy response for the payment, either success or failure, then it's not good

151
00:09:56,170 --> 00:09:59,440
for your application because other things are relying on that.

152
00:09:59,440 --> 00:09:59,740
Right.

153
00:09:59,860 --> 00:10:03,920
You are resisting the student or for the examination or for the semester or whatever.

154
00:10:04,120 --> 00:10:09,380
So for that critical data, you should not use the circuit breaker here.

155
00:10:09,400 --> 00:10:12,030
It's fine because we are waiting the atrocities.

156
00:10:12,370 --> 00:10:17,290
So that's fine if we are not getting it and we are returning the dummy response and we are giving some

157
00:10:17,290 --> 00:10:20,740
time to address service to resolve that issue, whatever it is.

158
00:10:21,040 --> 00:10:22,920
But this is just one example.

159
00:10:23,320 --> 00:10:28,030
So you are calling the payment service, then you should not go with the circuit breaker.

160
00:10:29,450 --> 00:10:36,140
Yeah, that's all about resilience for the circuit breaker in what, Microsoft offices, so that's all

161
00:10:36,320 --> 00:10:39,650
for now, will proceed further in the next lecture.

162
00:10:40,130 --> 00:10:41,030
Thank you very much.
